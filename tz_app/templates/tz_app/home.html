{% extends "admin/base_site.html" %}
{% load i18n l10n tz %}{% load url from future %}

{% block extrahead %}
{{ block.super }}
<style type="text/css">
form { margin: .2em 0 .4em 0; }
label, span.label { display: inline-block; margin-right: 0.5em; text-align: right; width: 15em;}
div.module table { width: 100%; }
</style>
{% endblock %}

{% block content %}
<h2>Conversions in templates</h2>

<p><em>NB: the values of <tt>USE_L10N</tt> and <tt>USE_TZ</tt> are emulated with <tt>{% templatetag openblock %} localize {% templatetag closeblock %}</tt> and <tt>{% templatetag openblock %} localtime {% templatetag closeblock %}</tt> in these tables.</em></p>

<div class="module">
    <table>
        <caption>Conversions for the current datetime in UTC — <tt>{{ utc_now_repr }}</tt></caption>
        <tr>
            <td><tt>USE_L10N</tt></td>
            <td><tt>USE_TZ</tt></td>
            <td><tt>{% templatetag openvariable %} now {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|localtime {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|timezone:other_timezone {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|utc {% templatetag closevariable %}</tt></td>
        </tr>
{% localize off %}
{% localtime off %}
        <tr>
            <td><tt>False</tt></td>
            <td><tt>False</tt></td>
            <td>{{ utc_now }}</td>
            <td>{{ utc_now|localtime }}</td>
            <td>{{ utc_now|timezone:other_timezone }}</td>
            <td>{{ utc_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% localtime on %}
        <tr>
            <td><tt>False</tt></td>
            <td><tt>True</tt></td>
            <td>{{ utc_now }}</td>
            <td>{{ utc_now|localtime }}</td>
            <td>{{ utc_now|timezone:other_timezone }}</td>
            <td>{{ utc_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% endlocalize %}
{% localize on %}
{% localtime off %}
        <tr>
            <td><tt>True</tt></td>
            <td><tt>False</tt></td>
            <td>{{ utc_now }}</td>
            <td>{{ utc_now|localtime }}</td>
            <td>{{ utc_now|timezone:other_timezone }}</td>
            <td>{{ utc_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% localtime on %}
        <tr>
            <td><tt>True</tt></td>
            <td><tt>True</tt></td>
            <td>{{ utc_now }}</td>
            <td>{{ utc_now|localtime }}</td>
            <td>{{ utc_now|timezone:other_timezone }}</td>
            <td>{{ utc_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% endlocalize %}
    </table>
</div>

<div class="module">
    <table>
        <caption>Conversions for the current datetime in local time — <tt>{{ local_now_repr }}</tt></caption>
        <tr>
            <td><tt>USE_L10N</tt></td>
            <td><tt>USE_TZ</tt></td>
            <td><tt>{% templatetag openvariable %} now {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|localtime {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|timezone:other_timezone {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|utc {% templatetag closevariable %}</tt></td>
        </tr>
{% localize off %}
{% localtime off %}
        <tr>
            <td><tt>False</tt></td>
            <td><tt>False</tt></td>
            <td>{{ local_now }}</td>
            <td>{{ local_now|localtime }}</td>
            <td>{{ local_now|timezone:other_timezone }}</td>
            <td>{{ local_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% localtime on %}
        <tr>
            <td><tt>False</tt></td>
            <td><tt>True</tt></td>
            <td>{{ local_now }}</td>
            <td>{{ local_now|localtime }}</td>
            <td>{{ local_now|timezone:other_timezone }}</td>
            <td>{{ local_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% endlocalize %}
{% localize on %}
{% localtime off %}
        <tr>
            <td><tt>True</tt></td>
            <td><tt>False</tt></td>
            <td>{{ local_now }}</td>
            <td>{{ local_now|localtime }}</td>
            <td>{{ local_now|timezone:other_timezone }}</td>
            <td>{{ local_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% localtime on %}
        <tr>
            <td><tt>True</tt></td>
            <td><tt>True</tt></td>
            <td>{{ local_now }}</td>
            <td>{{ local_now|localtime }}</td>
            <td>{{ local_now|timezone:other_timezone }}</td>
            <td>{{ local_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% endlocalize %}
    </table>
</div>

<div class="module">
    <table>
        <caption>Conversions for the current datetime without time zone — <tt>{{ naive_now_repr }}</tt></caption>
        <tr>
            <td><tt>USE_L10N</tt></td>
            <td><tt>USE_TZ</tt></td>
            <td><tt>{% templatetag openvariable %} now {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|localtime {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|timezone:other_timezone {% templatetag closevariable %}</tt></td>
            <td><tt>{% templatetag openvariable %} now|utc {% templatetag closevariable %}</tt></td>
        </tr>
{% localize off %}
{% localtime off %}
        <tr>
            <td><tt>False</tt></td>
            <td><tt>False</tt></td>
            <td>{{ naive_now }}</td>
            <td>{{ naive_now|localtime }}</td>
            <td>{{ naive_now|timezone:other_timezone }}</td>
            <td>{{ naive_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% localtime on %}
        <tr>
            <td><tt>False</tt></td>
            <td><tt>True</tt></td>
            <td>{{ naive_now }}</td>
            <td>{{ naive_now|localtime }}</td>
            <td>{{ naive_now|timezone:other_timezone }}</td>
            <td>{{ naive_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% endlocalize %}
{% localize on %}
{% localtime off %}
        <tr>
            <td><tt>True</tt></td>
            <td><tt>False</tt></td>
            <td>{{ naive_now }}</td>
            <td>{{ naive_now|localtime }}</td>
            <td>{{ naive_now|timezone:other_timezone }}</td>
            <td>{{ naive_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% localtime on %}
        <tr>
            <td><tt>True</tt></td>
            <td><tt>True</tt></td>
            <td>{{ naive_now }}</td>
            <td>{{ naive_now|localtime }}</td>
            <td>{{ naive_now|timezone:other_timezone }}</td>
            <td>{{ naive_now|utc }}</td>
        </tr>
{% endlocaltime %}
{% endlocalize %}
    </table>
</div>

<h2>Conversion in forms and widgets</h2>

<form action="{% url 'home' %}" method="GET">
{{ form.as_p }}
<p><span class="label"></span><input type="submit" value="Submit"> or <a href="{% url 'home' %}">reset</a></p>
</form>

{% if value %}
<p><span class="label">You set the value to</span> <strong>{{ value }} in {{ TIME_ZONE }}</strong></p>
<p><span class="label">which is</span> <strong>{{ value|unlocalize }}</strong></p>
<p><span class="label">and</span> <strong>{{ value|utc|unlocalize }}</strong></p>
{% endif %}
{% if split_value %}
<p><span class="label">You set the split value to</span> <strong>{{ split_value }} in {{ TIME_ZONE }}</strong></p>
<p><span class="label">which is</span> <strong>{{ split_value|unlocalize }}</strong></p>
<p><span class="label">and</span> <strong>{{ split_value|utc|unlocalize }}</strong></p>
{% endif %}

<h2>Conversions in models</h2>

<p>
    <a href="{% url 'admin:app_list' 'tz_app' %}">Go to the admin and add some objects.</a>
    Here is the contents of the database:
</p>

{% localize on %}{# datetimes are more readable in ISO format #}

<div class="module">
    <table>
        <caption>Name objects</caption>
        <tr>
            <th>Name</th>
            <th>Dated</th>
            <th>Dated (UTC)</th>
        </tr>
{% for name in names %}
        <tr>
            <td>{{ name.name }}</td>
            <td>{{ name.dated }}</td>
            <td>{{ name.dated|utc }}</td>
        </tr>
{% endfor %}
    </table>
</div>

<div class="module">
    <table>
        <caption>Auto name objects</caption>
        <tr>
            <th>Name</th>
            <th>Created</th>
            <th>Updated</th>
        </tr>
{% for auto_name in auto_names %}
        <tr>
            <td>{{ auto_name.name }}</td>
            <td>{{ auto_name.created }}</td>
            <td>{{ auto_name.updated }}</td>
        </tr>
{% endfor %}
    </table>
</div>

{% endlocalize %}

{% endblock %}
